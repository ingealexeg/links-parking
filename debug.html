<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>TAS | Debug Data</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #222; color: #0f0; }
        .data-card { background: #000; border: 1px solid #0f0; padding: 20px; border-radius: 10px; }
        .label { color: #888; font-size: 0.8rem; }
        .value { font-size: 1.5rem; margin-bottom: 20px; color: #fff; font-family: monospace; }
        .yappy-header { background: #004581; padding: 10px; border-radius: 5px; text-align: center; margin-bottom: 20px; }
    </style>
</head>
<body>

    <div class="yappy-header">
        <img src="yappy_logo.png" style="height: 40px;" alt="Logo Yappy">
    </div>

    <div class="data-card">
        <div class="label">RAW DATA (Ticket ID):</div>
        <div id="debug-raw" class="value">Esperando...</div>

        <div class="label">MONTO RECIBIDO DEL SERVIDOR:</div>
        <div id="debug-monto" class="value">Consultando...</div>

        <div class="label">RESPONSE JSON COMPLETO:</div>
        <pre id="debug-json" style="font-size: 10px; color: #aaa; overflow-x: auto;"></pre>
    </div>

    <script>
        const CONFIG = {
            baseUrl: "https://eu-sandbox.j-pass.com",
            instId: "3569036549"
        };

        const params = new URLSearchParams(window.location.search);
        const ticket = params.get('ticket') || 'NO-DETECTADO';
        document.getElementById('debug-raw').innerText = ticket;

        async function testData() {
            try {
            // Este es el túnel que saltará el error de CORS
                const proxy = "https://corsproxy.io/?"; 
                const targetUrl = `${CONFIG.baseUrl}/api/v1/installation/${CONFIG.instId}/ticket/${ticket}/cost`;
        
            // Ahora la petición va a través del túnel
                const res = await fetch(proxy + encodeURIComponent(targetUrl));
                const data = await res.json();

                document.getElementById('debug-json').innerText = JSON.stringify(data, null, 2);

                if (data.status === "ok") {
                    document.getElementById('debug-monto').innerText = "Q" + data.item.cost.value;
                } else {
                    document.getElementById('debug-monto').innerText = "Respuesta del servidor: " + data.status;
                }
            } catch (e) {
                document.getElementById('debug-monto').innerText = "ERROR DE PROXY";
                document.getElementById('debug-json').innerText = "No se pudo conectar ni por el túnel: " + e.message;
            }
        }

        if (ticket !== 'NO-DETECTADO') testData();
    </script>
</body>
</html>
